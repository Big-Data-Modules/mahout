<!DOCTYPE html>
<html lang=" en ">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    Partial Implementation
    
  </title>

  <meta name="description" content="Distributed Linear Algebra">

  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- Font Awesome -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,500" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,700,700i" rel="stylesheet">

  <link rel="canonical" href="http://mahout.apache.org//users/classification/partial-implementation.html">
  <link rel="alternate" type="application/rss+xml" title="Apache Mahout" href="/%20/feed.xml">


</head>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98314020-1', 'auto');
  ga('send', 'pageview');
</script>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-mahout">

    <div class="container">

        <a class="navbar-brand" href="/">
          <img src="/assets/mahout-logo-blue.svg" alt="">
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <ul class="navbar-nav ml-auto">

                <!-- Download -->
                <li class="nav-item">
                    <a class="nav-link" href="/general/downloads">Download</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="/docs/latest/index.html">Overview</a>
                </li>

                <!-- Algorithms (Samsara / MR) -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Algorithms</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/algorithms/linear-algebra">Distributed Linear Algebra</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/preprocessors">Preprocessors</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/regression">Regression</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/clustering">Clustering</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders">Recommenders</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/map-reduce">MapReduce <i>(deprecated)</i></a>
                    </div>
                    <!--<a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/recommender-overview.html">Reccomender Overview</a></li> Do we still need? seems like short version of next post-->
                    <!--
                    <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/intro-cooccurrence-spark.html">Intro to Coocurrence With Spark</a></li>
                    <li role="separator" class="divider"></li>
                    <li><span>&nbsp;&nbsp;<a href="/docs/latest/algorithms/map-reduce"><b>MapReduce</b> (deprecated)</a><span></li>
                 -->
                </li>


                <!-- Developers -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Developers</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="/developers/developer-resources.html">Developer Resources</a>
                        <a class="dropdown-item" href="/developers/buildingmahout">Building Mahout from Source</a>
                        <a class="dropdown-item" href="/developers/issue-tracker">Issues Tracking (JIRA)</a>
                        <!-- <a class="dropdown-item" href="/developers/patch-check-list/">Patch Check List</a> going to github template -->
                        <!-- <a class="dropdown-item" href="/developers/reference/">References</a> a lot of overlap with books, talks, etc. page -->
                        <a class="dropdown-item" href="/developers/release-notes">Release Notes</a>
                        <!-- <a class="dropdown-item" href="/developers/thirdparty-dependencies/">Third Party Dependencies</a> is our site the reasonable place for this? -->
                        <!-- <a class="dropdown-item" href="/developers/version-control/">Version Control</a> -->
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">How To's</h6>
                        <a class="dropdown-item" href="/developers/how-to-contribute">How to Contribute</a>
                        <a class="dropdown-item" href="/developers/githubPRs">Github PRs</a>
                        <a class="dropdown-item" href="/developers/how-to-become-a-committer">How to Become a Committer</a>
                        <a class="dropdown-item" href="/developers/how-to-release">How to Release</a>
                        <a class="dropdown-item" href="/developers/how-to-update-the-website">How to Update the Website</a>
                    </div>
                </li>

                <!-- Docs -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Docs</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <h6 class="dropdown-header">Release</h6>
                        <a class="dropdown-item" href="/docs/0.13.0">0.13.0</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Latest Snapshot (Development)</h6>
                        <a class="dropdown-item" href="/docs/latest">0.13.1-SNAPSHOT</a>
                    </div>
                </li>

                <!-- Community -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Community</a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <!--<a class="dropdown-item" href="/community/history/">History of the Apache Mahout Project</a>-->
                        <!--<a class="dropdown-item" href="/community/blogs/">Blog Posts About Mahout</a>-->
                        <!--<a class="dropdown-item" href="/community/recent-upcoming-talks/">Recent and Upcoming Talks</a>-->
                        <!-- <a class="dropdown-item" href="/community/books-tutorials-and-talks/">Books Tutorials and Talks</a> -->
                        <!-- <a class="dropdown-item" href="/community/faq/">FAQ</a> needs a lot of updating -->
                        <a class="dropdown-item" href="/developers/gsoc">GSoC</a>
                        <!-- Is OK- updated Map/Reduce verbage to reflect Samsara -->
                        <!-- <a class="dropdown-item" href="/community/mahout-benchmarks/">Mahout Benchmarks</a> These are old, Keep them? -->
                        <!-- <a class="dropdown-item" href="/community/mahout-wiki/">Mahout Wiki</a> at very least needs links cleanedup - do we still want this even?-->
                        <a class="dropdown-item" href="/general/mailing-lists">Mailing Lists</a>
                        <!-- Clean and pretty -->
                        <!-- <a class="dropdown-item" href="/community/powered-by-mahout/">Powered By Mahout</a> needs update -->
                        <a class="dropdown-item" href="/general/privacy-policy">Privacy Policy</a>
                        <!-- <a class="dropdown-item" href="/community/professional-support/">Professional Support</a> update if we even want to keep -->
                        <a class="dropdown-item" href="/general/who-we-are">Who We Are</a>
                        <!-- nikolai needs to add himself -->
                    </div>
                </li>

                <!-- GitHub -->
                <li class="nav-item">
                    <a class="nav-link" href="http://github.com/apache/mahout"><i class="fa fa-github"></i></a>
                </li>

            </ul>

            <!-- <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form> -->

        </div>

    </div>

</nav>


  <h1 id="classifying-with-random-forests">Classifying with random forests</h1>

<p><a name="PartialImplementation-Introduction"></a></p>
<h1 id="introduction">Introduction</h1>

<p>This quick start page shows how to build a decision forest using the
partial implementation. This tutorial also explains how to use the decision
forest to classify new data.
Partial Decision Forests is a mapreduce implementation where each mapper
builds a subset of the forest using only the data available in its
partition. This allows building forests using large datasets as long as
each partition can be loaded in-memory.</p>

<p><a name="PartialImplementation-Steps"></a></p>
<h1 id="steps">Steps</h1>
<p><a name="PartialImplementation-Downloadthedata"></a></p>
<h2 id="download-the-data">Download the data</h2>
<ul>
  <li>The current implementation is compatible with the UCI repository file
format. In this example we’ll use the NSL-KDD dataset because its large
enough to show the performances of the partial implementation.
You can download the dataset here http://nsl.cs.unb.ca/NSL-KDD/
You can either download the full training set “KDDTrain+.ARFF”, or a 20%
subset “KDDTrain+_20Percent.ARFF” (we’ll use the full dataset in this
tutorial) and the test set “KDDTest+.ARFF”.</li>
  <li>Open the train and test files and remove all the lines that begin with
‘@’. All those lines are at the top of the files. Actually you can keep
those lines somewhere, because they’ll help us describe the dataset to
Mahout</li>
  <li>Put the data in HDFS: {code}
$HADOOP_HOME/bin/hadoop fs -mkdir testdata
$HADOOP_HOME/bin/hadoop fs -put <PATH TO="" DATA=""> testdata{code}</PATH></li>
</ul>

<p><a name="PartialImplementation-BuildtheJobfiles"></a></p>
<h2 id="build-the-job-files">Build the Job files</h2>
<ul>
  <li>In $MAHOUT_HOME/ run: {code}mvn clean install -DskipTests{code}</li>
</ul>

<p><a name="PartialImplementation-Generateafiledescriptorforthedataset:"></a></p>
<h2 id="generate-a-file-descriptor-for-the-dataset">Generate a file descriptor for the dataset:</h2>
<p>run the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$HADOOP_HOME/bin/hadoop jar $MAHOUT_HOME/core/target/mahout-core-&lt;VERSION&gt;-job.jar org.apache.mahout.classifier.df.tools.Describe -p testdata/KDDTrain+.arff -f testdata/KDDTrain+.info -d N 3 C 2 N C 4 N C 8 N 2 C 19 N L
</code></pre>
</div>

<p>The “N 3 C 2 N C 4 N C 8 N 2 C 19 N L” string describes all the attributes
of the data. In this cases, it means 1 numerical(N) attribute, followed by
3 Categorical(C) attributes, …L indicates the label. You can also use ‘I’
to ignore some attributes</p>

<p><a name="PartialImplementation-Runtheexample"></a></p>
<h2 id="run-the-example">Run the example</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>$HADOOP_HOME/bin/hadoop jar $MAHOUT_HOME/examples/target/mahout-examples-&lt;version&gt;-job.jar org.apache.mahout.classifier.df.mapreduce.BuildForest -Dmapred.max.split.size=1874231 -d testdata/KDDTrain+.arff -ds testdata/KDDTrain+.info -sl 5 -p -t 100 -o nsl-forest
</code></pre>
</div>

<p>which builds 100 trees (-t argument) using the partial implementation (-p).
Each tree is built using 5 random selected attribute per node (-sl
argument) and the example outputs the decision tree in the “nsl-forest”
directory (-o).
The number of partitions is controlled by the -Dmapred.max.split.size
argument that indicates to Hadoop the max. size of each partition, in this
case 1/10 of the size of the dataset. Thus 10 partitions will be used.
IMPORTANT: using less partitions should give better classification results,
but needs a lot of memory. So if the Jobs are failing, try increasing the
number of partitions.</p>
<ul>
  <li>
    <p>The example outputs the Build Time and the oob error estimation</p>

    <p>10/03/13 17:57:29 INFO mapreduce.BuildForest: Build Time: 0h 7m 43s 582
  10/03/13 17:57:33 INFO mapreduce.BuildForest: oob error estimate :
0.002325895231517865
  10/03/13 17:57:33 INFO mapreduce.BuildForest: Storing the forest in:
nsl-forest/forest.seq</p>
  </li>
</ul>

<p><a name="PartialImplementation-UsingtheDecisionForesttoClassifynewdata"></a></p>
<h2 id="using-the-decision-forest-to-classify-new-data">Using the Decision Forest to Classify new data</h2>
<p>run the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$HADOOP_HOME/bin/hadoop jar $MAHOUT_HOME/examples/target/mahout-examples-&lt;version&gt;-job.jar org.apache.mahout.classifier.df.mapreduce.TestForest -i nsl-kdd/KDDTest+.arff -ds nsl-kdd/KDDTrain+.info -m nsl-forest -a -mr -o predictions
</code></pre>
</div>

<p>This will compute the predictions of “KDDTest+.arff” dataset (-i argument)
using the same data descriptor generated for the training dataset (-ds) and
the decision forest built previously (-m). Optionally (if the test dataset
contains the labels of the tuples) run the analyzer to compute the
confusion matrix (-a), and you can also store the predictions in a text
file or a directory of text files(-o). Passing the (-mr) parameter will use
Hadoop to distribute the classification.</p>

<ul>
  <li>
    <p>The example should output the classification time and the confusion
matrix</p>

    <p>10/03/13 18:08:56 INFO mapreduce.TestForest: Classification Time: 0h 0m 6s
355
  10/03/13 18:08:56 INFO mapreduce.TestForest:
=======================================================
  Summary
  ——————————————————-
  Correctly Classified Instances		:      17657	   78.3224%
  Incorrectly Classified Instances	:	4887	   21.6776%
  Total Classified Instances		:      22544</p>

    <p>=======================================================
  Confusion Matrix
  ——————————————————-
  a	b	&lt;–Classified as
  9459	252	 |  9711	a     = normal
  4635	8198	 |  12833	b     = anomaly
  Default Category: unknown: 2</p>
  </li>
</ul>

<p>If the input is a single file then the output will be a single text file,
in the above example ‘predictions’ would be one single file. If the input
if a directory containing for example two files ‘a.data’ and ‘b.data’, then
the output will be a directory ‘predictions’ containing two files
‘a.data.out’ and ‘b.data.out’</p>

<p><a name="PartialImplementation-KnownIssuesandlimitations"></a></p>
<h2 id="known-issues-and-limitations">Known Issues and limitations</h2>
<p>The “Decision Forest” code is still “a work in progress”, many features are
still missing. Here is a list of some known issues:</p>
<ul>
  <li>For now, the training does not support multiple input files. The input
dataset must be one single file (this support will be available with the upcoming release). 
Classifying new data does support multiple
input files.</li>
  <li>The tree building is done when each mapper.close() method is called.
Because the mappers don’t refresh their state, the job can fail when the
dataset is big and you try to build a large number of trees.</li>
</ul>


  <footer class="footer bg-light">
    <div class="container text-center small">
        Copyright &copy; 2014-2020 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.
    </div>
</footer>

  <script src="/assets/vendor/jquery/jquery-slim.min.js"></script>
  <script src="/assets/vendor/popper/popper.min.js"></script>
  <script src="/assets/vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="/assets/header.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

</body>

</html>
